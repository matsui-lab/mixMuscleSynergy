% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/best_fit.R
\name{select_optimal_K_r_mpca}
\alias{select_optimal_K_r_mpca}
\title{Search for the Best (K, r) for Mixture PCA via Grid Search}
\usage{
select_optimal_K_r_mpca(
  list_of_data,
  Kvec = 1:5,
  rvec = 1:5,
  max_iter = 50,
  nIterPCA = 5,
  tol = 0.001,
  method = "EM",
  n_init = 1,
  use_kmeans_init = TRUE,
  subject_rdim_for_kmeans = 2
)
}
\arguments{
\item{list_of_data}{A list of data matrices, each (T_i x M).}

\item{Kvec}{An integer vector of candidate K values.}

\item{rvec}{An integer vector of candidate r values.}

\item{max_iter}{Maximum EM iterations.}

\item{nIterPCA}{Sub-iterations within the PCA/PPCA update in C++.}

\item{tol}{Convergence tolerance.}

\item{method}{"EM" or "closed_form" (passed to mixture_pca_em_fit).}

\item{n_init}{Number of random initializations to try inside mixture_pca_em_fit.}

\item{use_kmeans_init}{Logical; whether to also try a k-means-based init.}

\item{subject_rdim_for_kmeans}{Dimension for PCA-based features if use_kmeans_init=TRUE.}
}
\value{
A list with:
  \item{summary}{A data.frame with columns K, r, logLik, BIC.}
  \item{best_model_info}{A list with (K, r, model, logLik, BIC) for the best BIC.}
  \item{all_models}{A list of all fits, each (K, r, model, logLik, BIC).}
}
\description{
This function tries all combinations of K in Kvec and r in rvec,
fits a Mixture PCA (PPCA) model using mixture_pca_em_fit
for each combination, computes BIC, and returns the best model by BIC.
}
\details{
- Calls mixture_pca_em_fit(..., n_init, use_kmeans_init, ...) for each (K, r).
- Uses fit$logLik as the final log-likelihood.
- BIC formula can be adjusted if needed. By default, we might do
  p = K*(M*r + r + M) + (K-1), for example, if we consider each cluster having:
  - W is M x r (or equivalently P x D)
  - mu is length M
  - sigma2 is 1 scalar
  - mixing proportions (K-1)
}
