% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/simulate_and_run_parallel_save.R
\name{simulate_and_run_parallel_save}
\alias{simulate_and_run_parallel_save}
\title{Run Simulation (MFA & MPCA) in Parallel, Saving Each Condition Separately}
\usage{
simulate_and_run_parallel_save(
  K_true_vec = c(3, 4),
  r_true_vec = c(3, 5),
  N_vec = c(50),
  M_vec = c(8, 12),
  T_each = 100,
  sep_vec = c(0.5, 1),
  noise_vec = c(1, 2),
  K_candidates = 1:5,
  r_candidates = 1:5,
  max_iter = 30,
  n_rep_init = 5,
  seed_data_base = 2023,
  mc.cores = parallel::detectCores() - 1,
  output_dir = "results"
)
}
\arguments{
\item{K_true_vec}{Vector of true K values to simulate.}

\item{r_true_vec}{Vector of true r values to simulate.}

\item{N_vec}{Vector of subject counts.}

\item{M_vec}{Vector of channel counts.}

\item{T_each}{Time-series length.}

\item{sep_vec}{Vector of separation parameters.}

\item{noise_vec}{Vector of noise scale parameters.}

\item{K_candidates}{Vector of candidate K values to try.}

\item{r_candidates}{Vector of candidate r values to try.}

\item{max_iter}{Max iteration for EM.}

\item{n_rep_init}{Number of random initial seeds for each (K,r) in search.}

\item{seed_data_base}{Base seed for data simulation.}

\item{mc.cores}{Number of parallel cores to use.}

\item{output_dir}{Directory to save each result as \code{result_K{...}_r{...}...rds}.}
}
\value{
A data frame with columns:
\item{K_true, r_true, N, M, sep, noise}{True simulation parameters.}
\item{ARI_MFA, BIC_MFA, Khat_MFA, rhat_MFA, ARI_PCA, BIC_PCA, Khat_PCA, rhat_PCA}{Results.}
}
\description{
This function enumerates a grid of \code{(K_true, r_true, N, M, sep, noise)} values,
simulates data, and tries a range of \code{(K, r)} with multiple initial seeds
for both MFA and Mixture PCA. It selects the best model by BIC for each method,
computes ARI, and saves the result to an \code{.rds} file per condition.
}
\details{
For each condition, the function calls \code{\link{simulate_mixture_data}} to create data,
then loops over candidate K, r in \code{K_candidates} and \code{r_candidates}, fits MFA and MPCA multiple times,
picks the best BIC, and computes ARI relative to the true cluster assignment.

Finally, it saves a \code{data.frame} of length 1 (or 2) in an \code{.rds} file for that condition,
and returns a merged data frame of all conditions.
}
